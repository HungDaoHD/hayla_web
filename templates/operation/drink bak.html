<!-- Load template html -->
{% extends "./base.html" %}

<!-- Title -->
{% block title %}Drink | Haylà{% endblock %}


<!-- [ breadcrumb ] start -->
{% block breadcrumb %}
<div class="col-md-12">
  <ul class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item"><a href="javascript: void(0)">Operation</a></li>
    <li class="breadcrumb-item" aria-current="page">Drink</li>
  </ul>
</div>

<div class="col-md-12">
  <div class="page-header-title">
    <h2 class="mb-0">Drink</h2>
  </div>
</div>

{% endblock %}
<!-- [ breadcrumb ] end -->


<!-- [ Main Content ] start -->
{% block main_content %}
<div class="text-end p-2 pb-2">
  <a href="#" class="btn btn-primary d-inline-flex align-item-center" data-bs-toggle="modal" data-bs-target="#user-edit_add-modal">
    <i class="ti ti-plus f-18"></i>Add
  </a>
</div>

<ul class="nav nav-pills p-2" id="pills-tab" role="tablist">

  <li class="nav-item">
    <a class="nav-link active" id="pills-cafe-tab"drink.html data-bs-toggle="pill" href="#pills-cafe" role="tab" aria-controls="pills-cafe" aria-selected="true">
      Cafe
    </a>
  </li>

  <li class="nav-item">
    <a class="nav-link" id="pills-milktea-tab" data-bs-toggle="pill" href="#pills-milktea" role="tab" aria-controls="pills-milktea" aria-selected="false">
      Trà Sữa
    </a>
  </li>

  <li class="nav-item">
    <a class="nav-link" id="pills-fruittea-tab" data-bs-toggle="pill" href="#pills-fruittea" role="tab" aria-controls="pills-fruittea" aria-selected="false">
      Trà Trái Cây
    </a>
  </li>

  {% if user.role.lower() == 'admin' %}

    <li class="nav-item">
      <a class="nav-link" id="pills-price-tab" data-bs-toggle="pill" href="#pills-price" role="tab" aria-controls="pills-price" aria-selected="false">
        Giá tiền
      </a>
    </li>

  {% endif %}

</ul>

<div class="tab-content" id="pills-tabContent">

  {% for group, lst_drink in dict_drink.items() %}

    {% if group in ['Cafe'] %}
      {% set tabname, str_active = 'cafe', 'active' %}
    {% elif group in ['Trà sữa'] %}
      {% set tabname, str_active = 'milktea', '' %}
    {% else %}
      {% set tabname, str_active = 'fruittea', '' %}
    {% endif %}

    <div class="tab-pane fade show {{ str_active }}" id="pills-{{ tabname }}" role="tabpanel" aria-labelledby="pills-{{ tabname }}-tab">

      <div class="row">

      {% for drink in lst_drink %}
        <div class="col-sm-12">
          <div class="card table-card">
            <div class="card-body table-border-style">

              <h4 class="m-2">
                <span class="badge bg-green-300">{{ drink.Drink_ID }}</span>
                <span class="badge bg-green-500">{{ drink.Drink_Name }}</span>
              </h4>

              <div class="table-responsive">

                <table class="table table-hover" id="dt-drink-ingredient">

                  <thead>

                    <tr>

                      <th colspan="1"></th>

                      <th colspan="{{ 2 if user.role.lower() == 'admin' else 1 }}" class="text-center">
                        <span class="badge bg-light-info border border-info f-14">Size M</span>
                        {% if user.role.lower() == 'admin' %}
                          <span class="badge bg-light-primary f-14">Cost {{ "{:,.0f}".format(drink.Total_Cost) }} VND</span>
                        {% endif %}
                      </th>

                      <th colspan="{{ 2 if user.role.lower() == 'admin' else 1 }}" class="text-center">
                        <span class="badge bg-light-warning border border-warning f-14">Size L</span>
                        {% if user.role.lower() == 'admin' %}
                          <span class="badge bg-light-primary f-14">Cost {{ "{:,.0f}".format(drink.Total_Cost * 1.5) }} VND</span>
                        {% endif %}
                      </th>

                    </tr>

                    <tr class="border-bottom-primary">
                      <th>Name</th>
                      <th class="text-center">Used Quanty</th>

                      {% if user.role.lower() == 'admin' %}
                        <th class="text-center">Cost (VND)</th>
                      {% endif %}

                      <th class="text-center">Used Quanty</th>

                      {% if user.role.lower() == 'admin' %}
                        <th class="text-center">Cost (VND)</th>
                      {% endif %}

                    </tr>

                  </thead>

                  <tbody>

                    {% for item in drink.Ingredients %}
                      <tr data-id="{{ drink.Drink_ID }}">

                        <td>
                          <div class="row">
                            <div class="col">
                              <h6 class="mb-0">{{ item.Ingredient_Name }}</h6>
                              <p class="text-muted f-12 mb-0">{{ item.Ingredient_ID }}</p>
                            </div>
                          </div>
                        </td>

                        <td class="text-center">
                          <div class="row">
                            <div class="col">
                              <a class="mb-0">{{ item.Ingredient_Quanty }}</a>
                              <p class="text-muted f-12 mb-0">{{ item.Unit }}</p>
                            </div>
                          </div>
                        </td>

                        {% if user.role.lower() == 'admin' %}
                          <td class="text-center">{{ "{:,.0f}".format(item.Total_Cost) }}</td>
                        {% endif %}

                        <td class="text-center"><div class="row">
                            <div class="col">
                              <a class="mb-0">{{ item.Ingredient_Quanty * 1.5 }}</a>
                              <p class="text-muted f-12 mb-0">{{ item.Unit }}</p>
                            </div>
                          </div>
                        </td>

                        {% if user.role.lower() == 'admin' %}
                          <td class="text-center">{{ "{:,.0f}".format(item.Total_Cost * 1.5) }}</td>
                        {% endif %}

                      </tr>
                    {% endfor %}


                  </tbody>

                </table>
              </div>

            </div>
          </div>
        </div>
      {% endfor %}

      </div>

    </div>

  {% endfor %}

  {% if user.role.lower() == 'admin' %}
    <div class="tab-pane fade show" id="pills-price" role="tabpanel" aria-labelledby="pills-price-tab">
    <div class="row">
      <div class="col-sm-12">
        <div class="card table-card">
          <div class="card-body table-border-style">

            <div class="table-responsive">
              <table class="table table-hover" id="dt-drink-price">

                <thead>
                  <tr>
                    <th></th>
                    <th colspan="3" class="text-center">SGN</th>
                    <th colspan="9" class="text-center">NTR</th>
                  </tr>

                  <tr>
                    <th></th>
                    <th colspan="3" class="text-center">M</th>
<!--                    <th colspan="3" class="text-center">S</th>-->
                    <th colspan="3" class="text-center">M</th>
                    <th colspan="3" class="text-center">L</th>
                  </tr>

                  <tr class="border-bottom-primary">
                    <th>Name</th>
                    <th class="text-center">Cost</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Margin-%</th>

<!--                    <th class="text-center">Cost</th>-->
<!--                    <th class="text-center">Price</th>-->
<!--                    <th class="text-center">Margin-%</th>-->

                    <th class="text-center">Cost</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Margin-%</th>

                    <th class="text-center">Cost</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Margin-%</th>

                  </tr>

                </thead>

                <tbody>

                  {% for group, lst_drink in dict_drink.items() %}

                    {% for drink in lst_drink %}

                      <tr data-id="{{ drink.Drink_ID }}">

                        <td>
                          <div class="row">
                            <div class="col">
                              <h6 class="mb-0">{{ drink.Drink_Name }}</h6>
                              <p class="text-muted f-12 mb-0">{{ drink.Drink_ID }}</p>
                            </div>
                          </div>
                        </td>

                        <!-- SGN -->
                        <td class="text-center">{{ "{:,.0f}".format(drink.Total_Cost) }}</td>
                        <td class="text-center">{{ "{:,.0f}".format(drink.Price.SGN.Size_M) }}</td>

                        {% set pct_margin = (1 - (drink.Total_Cost / drink.Price.SGN.Size_M)) * 100 %}

                        {% if pct_margin < 70 %}
                          {% set clr_badge = 'danger' %}
                        {% elif 70 <= pct_margin < 80 %}
                          {% set clr_badge = 'warning' %}
                        {% elif 80 <= pct_margin < 90 %}
                          {% set clr_badge = 'primary' %}
                        {% else %}
                          {% set clr_badge = 'success' %}
                        {% endif %}

                        <td class="text-center">
                          <span class="badge bg-light-{{ clr_badge }} f-14">{{ "{:.0f}".format(pct_margin) }}</span>
                        </td>

<!--                        &lt;!&ndash; NTR - S &ndash;&gt;-->
<!--                        <td class="text-center">NA</td>-->
<!--                        <td class="text-center">{{ "{:,.0f}".format(drink.Price.NTR.Size_S) }}</td>-->
<!--                        <td class="text-center">NA</td>-->

                        <!-- NTR - M -->
                        {% if drink.Price.NTR.Size_M > 0 %}
                          {% set pct_margin = (1 - (drink.Total_Cost / drink.Price.NTR.Size_M)) * 100 %}

                          {% if pct_margin < 70 %}
                            {% set clr_badge = 'danger' %}
                          {% elif 70 <= pct_margin < 80 %}
                            {% set clr_badge = 'warning' %}
                          {% elif 80 <= pct_margin < 90 %}
                            {% set clr_badge = 'primary' %}
                          {% else %}
                            {% set clr_badge = 'success' %}
                          {% endif %}

                        {% else %}
                          {% set pct_margin = 0 %}
                          {% set clr_badge = 'secondary' %}
                        {% endif %}


                        <td class="text-center">{{ "{:,.0f}".format(drink.Total_Cost) }}</td>
                        <td class="text-center">{{ "{:,.0f}".format(drink.Price.NTR.Size_M) }}</td>
                        <td class="text-center"><span class="badge bg-light-{{ clr_badge }} f-14">{{ "{:.0f}".format(pct_margin) }}</span></td>

                        <!-- NTR - L -->
                        {% if drink.Price.NTR.Size_L > 0 %}
                          {% set pct_margin = (1 - (drink.Total_Cost * 1.5 / drink.Price.NTR.Size_L)) * 100 %}

                          {% if pct_margin < 70 %}
                            {% set clr_badge = 'danger' %}
                          {% elif 70 <= pct_margin < 80 %}
                            {% set clr_badge = 'warning' %}
                          {% elif 80 <= pct_margin < 90 %}
                            {% set clr_badge = 'primary' %}
                          {% else %}
                            {% set clr_badge = 'success' %}
                          {% endif %}

                        {% else %}
                          {% set pct_margin = 0 %}
                          {% set clr_badge = 'secondary' %}
                        {% endif %}

                        <td class="text-center">{{ "{:,.0f}".format(drink.Total_Cost * 1.5) }}</td>
                        <td class="text-center">{{ "{:,.0f}".format(drink.Price.NTR.Size_L) }}</td>
                        <td class="text-center"><span class="badge bg-light-{{ clr_badge }} f-14">{{ "{:.0f}".format(pct_margin) }}</span></td>

                      </tr>

                    {% endfor %}
                  {% endfor %}

                </tbody>

              </table>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
<!-- [ Main Content ] end -->